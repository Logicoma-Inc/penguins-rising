<!DOCTYPE html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
    <title>Penguins Rising</title>
    <meta name="description" content=""/>
    <style type="text/css" media="screen">
	    *{ margin: 0; padding: 0; }
        html, body { width:  100%; height: 100%; }
        canvas {
		    display:block;
            image-rendering: optimizeSpeed;
            image-rendering: -moz-crisp-edges;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: optimize-contrast;
			cursor: crosshair;
        }
		</style>
</head>
<body id="body" onload="setup()"></body>
<canvas id="window"></canvas>
</html>
<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
<script>
Array.prototype.erase = function (item) {
	for (var i = this.length; i--; i) {
		if (this[i] === item) this.splice(i, 1);
	}

	return this;
};

Function.prototype.bind = function (bind) {
	var self = this;
	return function () {
		var args = Array.prototype.slice.call(arguments);
		return self.apply(bind || null, args);
	};
};

merge = function (original, extended) {
	for (var key in extended) {
		var ext = extended[key];
		if (typeof (ext) != 'object' || ext instanceof Class) {
			original[key] = ext;
		} else {
			if (!original[key] || typeof (original[key]) != 'object') {
				original[key] = {};
			}
			merge(original[key], ext);
		}
	}
	return original;
};

function copy(object) {
	if (!object || typeof (object) != 'object' || object instanceof Class) {
		return object;
	} else if (object instanceof Array) {
		var c = [];
		for (var i = 0, l = object.length; i < l; i++) {
			c[i] = copy(object[i]);
		}
		return c;
	} else {
		var c = {};
		for (var i in object) {
			c[i] = copy(object[i]);
		}
		return c;
	}
}

function ksort(obj) {
	if (!obj || typeof (obj) != 'object') {
		return [];
	}

	var keys = [],
		values = [];
	for (var i in obj) {
		keys.push(i);
	}

	keys.sort();
	for (var i = 0; i < keys.length; i++) {
		values.push(obj[keys[i]]);
	}

	return values;
}

/* Simple JavaScript Inheritance
 * By John Resig http://ejohn.org/
 * MIT Licensed.
 */
// Inspired by base2 and Prototype
(function(){
  var initializing = false, fnTest = /xyz/.test(function(){xyz;}) ? /\b_super\b/ : /.*/;
 
  // The base Class implementation (does nothing)
  this.Class = function(){};
 
  // Create a new Class that inherits from this class
  Class.extend = function(prop) {
    var _super = this.prototype;
   
    // Instantiate a base class (but only create the instance,
    // don't run the init constructor)
    initializing = true;
    var prototype = new this();
    initializing = false;
   
    // Copy the properties over onto the new prototype
    for (var name in prop) {
      // Check if we're overwriting an existing function
      prototype[name] = typeof prop[name] == "function" &&
        typeof _super[name] == "function" && fnTest.test(prop[name]) ?
        (function(name, fn){
          return function() {
            var tmp = this._super;
           
            // Add a new ._super() method that is the same method
            // but on the super-class
            this._super = _super[name];
           
            // The method only need to be bound temporarily, so we
            // remove it when we're done executing
            var ret = fn.apply(this, arguments);        
            this._super = tmp;
           
            return ret;
          };
        })(name, prop[name]) :
        prop[name];
    }
   
    // The dummy class constructor
    function Class() {
      // All construction is actually done in the init method
      if ( !initializing && this.init )
        this.init.apply(this, arguments);
    }
   
    // Populate our constructed prototype object
    Class.prototype = prototype;
   
    // Enforce the constructor to be what we expect
    Class.prototype.constructor = Class;
 
    // And make this class extendable
    Class.extend = arguments.callee;
   
    return Class;
  };
})();
var canvas = null;
$(window).resize(function () { 
	canvas.width = window.innerWidth;
	canvas.height = window.innerHeight; 
});
var ctx = null;
var img = null;
var frameRate = 1000/60;
var framecount = 0;
var frame = 0;
var frames = [];
var Landscape = Class.extend({
	init: function(){
	this.Objects;
	}
});
var Weapon = Class.extend({
	init: function(){
	this.Rate;//speed of the weapon
	this.Type;
	this.Animation;
	this.Box;
	this.Bullets;//bullet count before reload
	this.Sound;
	}
});
var Player = Class.extend({
	init: function(){
		this.Position;
		this.Animation;
		this.Box;
		this.Rotation;
	}
});
var Penguins = Class.extend({
	init: function(){
	this.Level;
	this.Position;
	this.Speed;
	this.Animation;
	this.Box;
	this.Sound;
	this.Hit;
	}
});
var World = Landscape.extend({
	init: function(level){
		this.Score;
		this.Level = level;
		this.assets = [ 60, 90, 150, 180, 210, 180, 150 ,90];
		this.mouseX = 0;
		this.mouseY = 0;
	}
});
var message = "Start you engines!";
var world = new World(1);//Needs to be Global;
console.log("User at Level:"+world.Level);
var penguins = Penguins();
var setup = function(){
	canvas = document.getElementById("window");
	canvas.addEventListener('mousemove', function(evt) {
        var mousePos = getMousePos(canvas, evt);
        message = 'Mouse position: ' + mousePos.x + ',' + mousePos.y;
		world.mouseX = mousePos.x;
		world.mouseY = mousePos.y;
      }, false);
	canvas.addEventListener('mousedown', onKeyDown);
	ctx = canvas.getContext('2d');
	canvas.width = window.innerWidth;
	canvas.height = window.innerHeight;
	img = new Image();
	img.onload = function(){
		//where to start clipping, size of the clipped, and where to place.
		//lastly the size of the cut out image in the canvas. all (x,y)
		//can not be greater than 1008 width
		ctx.drawImage(img, 0,0, 1008, 700, 0, 0, canvas.width, canvas.height);
	}	
	img.src = "landscape2.png";
	//var f = new Fort("test");
	//console.log(f.Status);
	setInterval(animate, frameRate)
};


var animate = function() {
	ctx.clearRect(0, 0, canvas.width, canvas.height);
	ctx.drawImage(img, 0,0, 1008, 700, 0, 0, canvas.width, canvas.height);
	ctx.font = "bold 22px Arial";
	ctx.fillText("Score:0", 10, 25);
	ctx.fillText("Level:"+world.Level, canvas.width - 90, 25);
	ctx.fillText(message, 10, 45);
	ctx.save();
	ctx.translate(canvas.width/2, canvas.height-60);
	//ctx.rotate(Math.atan(world.mouseX, (world.mouseY+canvas.height)));
	ctx.rotate(Math.atan2(world.mouseX-(canvas.width/2), canvas.height-world.mouseY));
	ctx.drawImage(img, 0, 702, 50, 65, -25, -33, 50, 66);
	//this is not needed since we have a save state and restore call.
	//ctx.rotate(-(world.mouseX/world.mouseY)/Math.PI);
	ctx.restore();
};
function writeMessage(canvas, message) {
        var context = canvas.getContext('2d');
        context.clearRect(0, 0, canvas.width, canvas.height);
        context.font = '18pt Calibri';
        context.fillStyle = 'black';
        context.fillText(message, 10, 25);
      };

//Input engine!  
function getMousePos(canvas, evt) {
        var rect = canvas.getBoundingClientRect();
        return {
          x: evt.clientX - rect.left,
          y: evt.clientY - rect.top
        };
      };
function onKeyDown(event){
		event.preventDefault();
	  };
</script>
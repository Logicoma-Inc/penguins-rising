/*!
 * Penguins Rising
 * @author Anthony Fassett
 * @version 2.0.0
 * Copyright 2015.
 */
function getMousePos(a,b){var c=a.getBoundingClientRect();return{x:b.clientX-c.left,y:b.clientY-c.top}}function mouseClick(a){a.preventDefault(),player.shot||(player.shoot(),setTimeout(function(){player.shot=!1},500),player.shot=!0)}function Enemy(a){return a=a||{},a.active=!0,a.age=Math.floor(128*Math.random()),a.x=Math.random()*canvas.width,a.y=0,a.xVelocity=0,a.yVelocity=.5,a.width=42,a.height=37,a.length=0,a.frame=void 0,a.index=0,a.elapsed=0,a.snd=new Audio(SoundTest?"content/audio/mp3/cry.mp3":"content/wav/cry.wav"),a.animation=new AnimationData([{x:40,length:180},{x:78,length:180},{x:127,length:180}],{repeats:!0,keyframe:0}),a.reset=function(){a.elapsed=0,a.index=0,a.frame=a.animation.frames[a.index]},a.reset(),a.length=a.animation.frames.length,a.inBounds=function(){return a.y!==canvas.height?a.x>=0&&a.x<=canvas.width&&a.y>=0&&a.y<=canvas.height:(player.health-=1,!1)},a.RnP=Math.floor(3*Math.random()),a.deadAnm=[169,204,250],a.draw=function(){a.active?ctx.drawImage(img,a.frame.x,0,a.width,a.height,a.x,a.y,a.width,a.height):ctx.drawImage(img,a.deadAnm[a.RnP],0,45,37,a.x,a.y,46,37)},a.update=function(){a.active&&(a.x+=a.xVelocity,a.y+=a.yVelocity,a.xVelocity=Math.sin(a.age*Math.PI/64),a.age++,a.active=a.active&&a.inBounds(),a.elapsed=a.elapsed+30,a.elapsed>=a.frame.length&&(a.index++,a.elapsed=a.elapsed-a.frame.length),this.index>=this.length&&(this.animation.options.repeats?this.index=this.animation.options.keyframe:this.index--),a.frame=a.animation.frames[a.index])},a.deactive=function(){a.active=!1},a}function Boss(){}function Bullet(a){return a.active=!0,a.speed=10,a.radian=Math.atan2(canvas.width/2-game.mousePos.x,canvas.height-60-game.mousePos.y),a.xVelocity=-a.speed*Math.sin(a.radian),a.yVelocity=-a.speed*Math.cos(a.radian),a.width=3,a.height=3,a.color="#000",a.inBounds=function(){return a.x>=0&&a.x<=canvas.width&&a.y>=0&&a.y<=canvas.height},a.draw=function(){ctx.fillStyle=a.color,ctx.fillRect(a.x,a.y,a.width,a.height)},a.update=function(){a.x+=a.xVelocity,a.y+=a.yVelocity,a.active=a.active&&a.inBounds()},a}function AnimationData(a,b){this.frames=a||[{x:0,y:0,w:0,h:0,length:0}],this.options=b||{repeats:!1,keyframe:0}}function draw(){ctx.clearRect(0,0,canvas.width,canvas.height),player.draw(),TheTrulyDead.forEach(function(a){a.draw()}),player.Bullets.forEach(function(a){a.draw()}),enemies.forEach(function(a){a.draw()}),ctx.fillText("Kills:"+TheTrulyDead.length,10,50),ctx.fillText("Level:"+game.Lvl,10,70),ctx.fillText("Health:"+player.health,10,100)}function update(){TheTrulyDead.length>game.LvlEnemies&&0===enemies.length&&(game.LvlComplete=!0,game.LvlEnemies+=15,game.Lvl+=1,player.health=1),player.health<=0&&(game.over=!0),!game.LvlComplete&&player.update?(player.Bullets.forEach(function(a){a.update()}),player.Bullets=player.Bullets.filter(function(a){return a.active}),enemies.forEach(function(a){a.update()}),enemies=enemies.filter(function(a){return a.active}),handleCollisions(),game.LvlEnemies>enemies.length&&TheTrulyDead.length<=game.LvlEnemies&&(enemies.push(Enemy()),bosses.push(Boss(this)))):(player.update||console.log("you died"),enemies=[],TheTrulyDead=[],bosses=[],game.LvlComplete=!1)}function collides(a,b){return a.x<b.x+b.width&&a.x+a.width>b.x&&a.y<b.y+b.height&&a.y+a.height>b.y}function handleCollisions(){player.Bullets.forEach(function(a){enemies.forEach(function(b){collides(a,b)&&(b.deactive(),TheTrulyDead.push(b),b.snd.play(),a.active=!1)})})}var achManager=achManager||{};achManager.achievements={},achManager.preloaded=!1,achManager.loadData=function(){var a=gapi.client.games.achievementDefinitions.list();a.execute(function(a){if(console.log("Achievement definitions",a),"games#achievementDefinitionsListResponse"===a.kind&&a.hasOwnProperty("items")){for(var b=0;b<a.items.length;b++)achManager.achievements[a.items[b].id]=a.items[b],achManager.achievements[a.items[b].id].achievementState=a.items[b].initialState;welcome.dataLoaded(welcome.ENUM_ACHIEVEMENT_DEFS),achManager.loadAchievementsEarnedByPlayer()}})},achManager.loadAchievementsEarnedByPlayer=function(){var a=gapi.client.games.achievements.list({playerId:"me"});a.execute(function(a){if(console.log("Your achievement data: ",a),"games#playerAchievementListResponse"===a.kind&&a.hasOwnProperty("items")){for(var b=0;b<a.items.length;b++){var c=a.items[b];achManager.achievements[c.id].achievementState=c.achievementState,c.hasOwnProperty("formattedCurrentStepsString")&&(achManager.achievements[c.id].formattedCurrentStepsString=c.formattedCurrentStepsString)}welcome.dataLoaded(welcome.ENUM_ACHIEVEMENT_PROGRESS)}else console.log("**Unexpected response **",a)}),achManager.preloaded=!0},achManager.scoreRequested=function(a){0===a?achManager.unlockAchievement(constants.ACH_HUMBLE):9999===a&&achManager.unlockAchievement(constants.ACH_COCKY)},achManager.scoreReturned=function(a){1337===a?achManager.unlockAchievement(constants.ACH_LEET):a>1&&utils.isPrime(a)&&achManager.unlockAchievement(constants.ACH_PRIME),achManager.submitProgress(constants.ACH_BORED,1),achManager.submitProgress(constants.ACH_REALLY_BORED,1)},achManager.getNameForId=function(a){return achManager.achievements[a].name},achManager.submitProgress=function(a,b){var c=gapi.client.games.achievements.increment({achievementId:a,stepsToIncrement:b});c.execute(function(b){console.log("Data from incrementing achievement is ",b),achManager.achievements[a].currentSteps=b.currentSteps,achManager.achievements[a].formattedCurrentStepsString=String(b.currentSteps),b.newlyUnlocked?achievementWidget.showAchievementWidget(a):console.log("You either haven't unlocked "+achManager.achievements[a].name+" yet, or you unlocked it already.")})},achManager.unlockAchievement=function(a){var b=gapi.client.games.achievements.unlock({achievementId:a});b.execute(function(b){console.log("Data from earning achievement is ",b),b.newlyUnlocked?(achievementWidget.showAchievementWidget(a),achManager.loadAchievementsEarnedByPlayer()):console.log("You unlocked "+achManager.achievements[a].name+" but you already unlocked it earlier.")})};var achievementTable=achievementTable||{};achievementTable.loadUp=function(){achievementTable.clearOut(),achManager.preloaded&&$.each(achManager.achievements,function(a,b){var c=achievementTable.buildTableRowFromData(b);c.appendTo($("#achievementsTable tbody"))}),$("#achievements").fadeIn(),$("#pageHeader").text("Achievements")},achievementTable.buildTableRowFromData=function(a){var b=$("<tr></tr>"),c=$("<td></td>").text(a.name).addClass("achievementName"),d=$("<td></td>").text(a.description).addClass("achievementDescrip"),e="";if("REVEALED"===a.achievementState){if(e=a.revealedIconUrl,"INCREMENTAL"===a.achievementType&&a.hasOwnProperty("formattedCurrentStepsString")){var f="("+a.formattedCurrentStepsString+"/"+a.formattedTotalSteps+")",g=$("<div></div>").text(f);d.append(g)}}else"UNLOCKED"===a.achievementState?e=a.unlockedIconUrl:"HIDDEN"===a.achievementState&&(e="images/Question_mark.png",c.text("Hidden"),d.text("This mysterious achievement will be revealed later"));var h=$("<img />").attr("src",e).attr("alt",a.achievementState).addClass("medIcon").appendTo($("<td></td>"));return b.append(c).append(d).append(h),b},achievementTable.goBack=function(){$("#achievements").fadeOut(),welcome.loadUp()},achievementTable.clearOut=function(){$("#achievementsTable tbody").html("")};var achievementWidget=achievementWidget||{};achievementWidget.showAchievementWidget=function(a){var b=$("#achUnlocked");b.find("img").prop("src",achManager.achievements[a].unlockedIconUrl),b.find("#achName").text(achManager.achievements[a].name),b.find("#achDescrip").text(achManager.achievements[a].description),b.css({top:"300px",opacity:"1.0"}),b.show(),b.delay(2e3).animate({top:50,opacity:.1},500,function(){b.hide()})};var game=game||{},img=null,bossimg=null,canvas=document.getElementById("window"),ctx=canvas.getContext("2d"),enemies=[],TheTrulyDead=[],bosses=[],player=player||{};canvas.width="innerWidth"in window?window.innerWidth:document.documentElement.offsetWidth,canvas.height="innerHeight"in window?window.innerHeight:document.documentElement.offsetHeight,game.mousePos={x:0,y:0},window.onresize=function(){canvas.height="innerHeight"in window?window.innerHeight:document.documentElement.offsetHeight,canvas.width="innerWidth"in window?window.innerWidth:document.documentElement.offsetWidth},canvas.addEventListener("mousemove",function(a){game.mousePos=getMousePos(canvas,a)},!1);var a=document.createElement("audio"),SoundTest=function(){return!(!a.createElement("audio").canPlayType||!a.canPlayType("audio/mpeg;").replace(/no/,""))};player={x:canvas.width/2,y:canvas.height-60,vx:0,vy:0,health:null,Bullets:[],active:!0,draw:function(){ctx.save(),ctx.translate(canvas.width/2,canvas.height-60),ctx.rotate(Math.atan2(game.mousePos.x-canvas.width/2,canvas.height-60-game.mousePos.y)),ctx.drawImage(img,0,0,42,59,-18,-33,42,59),ctx.restore()},update:function(){return player.health<1?!1:!0},shot:!1,snd:new Audio(SoundTest?"content/audio/mp3/gunshot.mp3":"content/audio/wav/gunshot.wav"),shoot:function(){var a=Math.atan2(canvas.width/2-game.mousePos.x,canvas.height-60-game.mousePos.y);player.snd.play(),player.Bullets.push(Bullet({radian:a,x:canvas.width/2+-18*Math.sin(a),y:canvas.height-60+-18*Math.cos(a)}))},displayName:"anonymous",profileUrl:"",userId:"",loadLocalPlayer:function(){var a=gapi.client.games.players.get({playerId:"me"});a.execute(function(a){a.displayName||(a.displayName="anonymous"),$("#welcome #message").text("Welcome, "+a.displayName+"!"),$("#welcomeAchievements, #welcomeleaderboards").fadeIn(),player.displayName=a.displayName,player.profileUrl=a.avatarImageUrl,player.userId=a.playerId,welcome.dataLoaded(welcome.ENUM_PLAYER_DATA)})}},Boss.prototype=new Enemy,window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,50)}}(),game.over=!1,game.startGame=function(){game.LvlEnemies=3,game.Lvl=1,player.health=10,img=new Image,img.src="content/img/characters.png",bossimg=new Image,bossimg.src="content/img/boss1.png",canvas.addEventListener("mousedown",mouseClick),function a(){game.over?confirm("Your lose! Start Over?")&&location.reload():(requestAnimFrame(a),update(),draw())}()};var leadManager=leadManager||{};leadManager.preloaded=!1,leadManager.leaderboards={},leadManager.preloadData=function(){var a=gapi.client.games.leaderboards.list();a.execute(function(a){if(console.log("Leaderboard data",a),"games#leaderboardListResponse"===a.kind&&a.hasOwnProperty("items"))for(var b=0;b<a.items.length;b++)leadManager.leaderboards[a.items[b].id]=a.items[b];leadManager.preloaded=!0,welcome.dataLoaded(welcome.ENUM_LEADERBOARDS)})},leadManager.getLeaderboardObject=function(a){return leadManager.leaderboards[a]},leadManager.gotScore=function(a,b,c){var d=b===game.EASY?constants.LEADERBOARD_EASY:constants.LEADERBOARD_HARD,e=gapi.client.games.scores.submit({leaderboardId:d,score:a});e.execute(function(a){console.log("Data from submitting high score is ",a);var b=!1;if(a.hasOwnProperty("beatenScoreTimeSpans"))for(var e=0;e<a.beatenScoreTimeSpans.length;e++)"WEEKLY"===a.beatenScoreTimeSpans[e]&&(console.log("Hooray! New weekly high score!"),b=!0,leaderboardWidget.show(d));c(b)})};var leaderboardWidget=leaderboardWidget||{};leaderboardWidget.show=function(a){var b=leadManager.getLeaderboardObject(a),c=b.iconUrl?b.iconUrl:"img/genericLeaderboard.png";$("#leadUnlocked img").prop("src",c),$("#leadUnlocked #leadName").text(b.name),$("#leadUnlocked").css({top:"250px",opacity:"1.0"}),$("#leadUnlocked").show(),$("#leadUnlocked").delay(3e3).animate({top:"50px",opacity:.1},500,function(){$("#leadUnlocked").hide()})};var leaderboardsTable=leaderboardsTable||{};leaderboardsTable.showAllLeaderboards=function(){leaderboardsTable.clearOut(),leadManager.preloaded&&($.each(leadManager.leaderboards,function(a,b){var c=leaderboardsTable.buildLeaderboardsRowFromData(b);c.appendTo($("#leaderboardsTable tbody"))}),$("#leaderboards").fadeIn()),$("#pageHeader").text("Leaderboards")},leaderboardsTable.buildLeaderboardsRowFromData=function(a){var b=$("<tr></tr>"),c=a.iconUrl?a.iconUrl:"img/genericLeaderboard.png",d=$("<td></td>").append($("<img />").prop("src",c).addClass("medIcon")),e=$("<td></td>").text(a.name),f=$("<td></td>").append($('<input type="button" />').prop("value","View").click(function(){leaderboardsTable.selectLeaderboard(a.id)}));return b.append(d).append(e).append(f),b},leaderboardsTable.selectLeaderboard=function(a){$("#leaderboards").hide(),leaderboardTable.showLeaderboard(a,leaderboardTable.BACK_TO_ALL_LEADERBOARDS)},leaderboardsTable.clearOut=function(){$("#leaderboardsTable tbody").html("")},leaderboardsTable.goBack=function(){$("#leaderboards").fadeOut(),welcome.loadUp()};var constants=constants||{};constants.CLIENT_ID="926286388840-qbj01r8d9on9dvnnba1m8iiknrtulrb1.apps.googleusercontent.com",constants.ACH_DONT_GET_COCKY_KID="CgkInoXkzIgWEAIQCA",constants.ACH_WERE_ALL_OUT_OF_BUBBLEGUM="CgkInoXkzIgWEAIQCw",constants.ACH_PRIME_TIME_FOR_YOUR_LIFE="CgkInoXkzIgWEAIQLg",constants.ACH_THE_PRINCESS_IS_BACK="CgkInoXkzIgWEAIQEg",constants.ACH_GOT_LUCKY="CgkInoXkzIgWEAIQDg",constants.ACH_A_TASTE_FOR_BLOOD="CgkInoXkzIgWEAIQDw",constants.ACH_KICKIN_IT_OLD_SKOOL="CgkInoXkzIgWEAIQDQ",constants.ACH_A_HIGHER_FOOD_CHAIN="CgkInoXkzIgWEAIQBw",constants.ACH_DONT_FEAR_THE_REPEAR="CgkInoXkzIgWEAIQKA",constants.ACH_THE_MOTHER_LOAD_OF_COWS="CgkInoXkzIgWEAIQEw",constants.ACH_ZOMBIE_PENGUIN_TRAINEE="CgkInoXkzIgWEAIQKQ",constants.ACH_ZOMBIE_PENGUIN_ADAPT="CgkInoXkzIgWEAIQBg",constants.ACH_ZOMBIE_PENGUIN_EXCEPT="CgkInoXkzIgWEAIQEQ",constants.ACH_ZOMBIE_PENGUIN_MASTER="CgkInoXkzIgWEAIQDA",constants.ACH_THERES_CAKE_AND_ICE_CREAM="CgkInoXkzIgWEAIQLA",constants.LEAD_HIGH_SCORES="CgkInoXkzIgWEAIQBQ",constants.LEAD_LONGEST_LIVED="CgkInoXkzIgWEAIQKg";var login=login||{};login.userId="",login.loggedIn=!1,login.scopes="https://www.googleapis.com/auth/games",login.init=function(){window.setTimeout(login.trySilentAuth,1)},login.loadClient=function(){gapi.client.load("games","v1",function(){achManager.loadData(),leadManager.preloadData(),welcome.loadUp(),$("#BetaInfo").hide()}),gapi.client.load("gamesManagement","v1management",function(){welcome.dataLoaded(welcome.ENUM_MANAGEMENT_API)}),gapi.client.load("plus","v1",function(){welcome.dataLoaded(welcome.ENUM_PLUS_API)})},login.handleAuthResult=function(a){console.log("We are in handle auth result");var b=document.createElement("SCRIPT");b.src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js",b.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(b),checkReady(function(b){a?(b("#loginDiv").fadeOut(),login.loadClient()):b("#loginDiv").fadeIn()})};var checkReady=function(a){window.jQuery?a(jQuery):window.setTimeout(function(){checkReady(a)},100)};login.trySilentAuth=function(){gapi.auth.authorize({client_id:constants.CLIENT_ID,scope:login.scopes,immediate:!0},login.handleAuthResult)},login.showLoginDialog=function(){gapi.auth.authorize({client_id:constants.CLIENT_ID,scope:login.scopes,immediate:!1},login.handleAuthResult)};var welcome=welcome||{};welcome.leaderboards_loaded=!1,welcome.achievement_defs_loaded=!1,welcome.achievement_progress_loaded=!1,welcome.player_data_loaded=!1,welcome.challenge_loaded=!1,welcome.management_APIs_loaded=!1,welcome.plus_APIs_loaded=!1,welcome.ENUM_LEADERBOARDS=1,welcome.ENUM_ACHIEVEMENT_DEFS=2,welcome.ENUM_ACHIEVEMENT_PROGRESS=3,welcome.ENUM_PLAYER_DATA=4,welcome.ENUM_CHALLENGE_DATA=5,welcome.ENUM_MANAGEMENT_API=6,welcome.ENUM_PLUS_API=7,welcome.dataLoaded=function(a){a===welcome.ENUM_LEADERBOARDS?welcome.leaderboards_loaded=!0:a===welcome.ENUM_ACHIEVEMENT_DEFS?welcome.achievement_defs_loaded=!0:a===welcome.ENUM_ACHIEVEMENT_PROGRESS?welcome.achievement_progress_loaded=!0:a===welcome.ENUM_PLAYER_DATA?welcome.player_data_loaded=!0:a===welcome.ENUM_CHALLENGE_DATA?welcome.challenge_loaded=!0:a===welcome.ENUM_MANAGEMENT_API?welcome.management_APIs_loaded=!0:a===welcome.ENUM_PLUS_API&&(welcome.plus_APIs_loaded=!0),welcome.activateButtonsIfReady()},welcome.activateButtonsIfReady=function(){welcome.leaderboards_loaded&&welcome.achievement_defs_loaded&&welcome.achievement_progress_loaded&&welcome.player_data_loaded&&welcome.challenge_loaded&&welcome.management_APIs_loaded&&welcome.plus_APIs_loaded&&($("#welcome input").attr("disabled",!1),$("#game").show(),welcome.startGame())},welcome.loadUp=function(){$("#welcome").fadeIn()},welcome.showCredits=function(a,b){var c=document.getElementById(a);c.style.display="none"!==c.style.display?"none":"",document.getElementById(b).style.display="block"===document.getElementById(b).style.display?"none":"block"},welcome.showAchievements=function(){achievementTable.loadUp()},welcome.showLeaderboards=function(){leaderboardsTable.showAllLeaderboards()},welcome.startGame=function(){document.getElementById("dialog-modal").style.display="none",document.getElementById("game").style.display="block",game.startGame()},function(){"use strict";function a(){this.successCount=0,this.errorCount=0,this.downloadQueue=[],this.cache={}}a.prototype.queueDownload=function(a){this.downloadQueue.push(a)},a.prototype.downloadAll=function(a){0===this.downloadQueue.length&&a();for(var b=0;b<this.downloadQueue.length;b++){var c=this.downloadQueue[b],d=new Image;d.src=c,this.cache[c]=d}},a.prototype.isDone=function(){return this.downloadQueue.length===this.successCount+this.errorCount},a.prototype.getAsset=function(a){return this.cache[a]};var b=new a;b.downloadAll(function(){}),b.isDone&&(document.getElementById("Gamer").innerHTML="Play"),function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-41648493-1","penguinsontherise.appspot.com"),ga("send","pageview")}();